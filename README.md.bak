# Clockify Add-ons (Python)

**Production-ready Clockify add-ons implemented in Python**

This repository contains two Clockify add-ons plus shared infrastructure:

1. **API Studio** - No-code API + webhook console (STANDARD plan)
2. **Universal Webhook + Any API Call** - Enterprise-grade universal webhook ingestion and automation (ENTERPRISE plan)
3. **Clockify Core** - Shared modules (HTTP client, OpenAPI loader, rate limiter)

---

## ğŸ¯ Add-ons

### 1. API Studio (`api_studio/`)
**For rapid prototyping and internal automation**

- **Plan**: STANDARD
- **Webhook Events**: 12 common events (TIME_ENTRY, PROJECT, CLIENT, TAG)
- **Scopes**: 7 resources (TIME_ENTRY, PROJECT, CLIENT, TAG, USER, CUSTOM_FIELDS, WORKSPACE)
- **Features**:
  - Lifecycle endpoints
  - Automatic GET bootstrap
  - Webhook receiver
  - No-code flow engine
  - API Explorer (safe GET operations)
  - JSON UI endpoints

### 2. Universal Webhook (`universal_webhook/`) â­
**Enterprise-grade automation platform**

- **Plan**: ENTERPRISE
- **Webhook Events**: ALL 50+ Clockify events + custom webhooks
- **Scopes**: ALL resources (READ + WRITE)
- **Features**:
  - Universal webhook ingestion (Clockify + custom sources)
  - Enhanced automatic GET bootstrap (configurable heavy endpoints, time entries)
  - API Explorer for ANY Clockify operation
  - Advanced no-code flows (with optional generic HTTP actions)
  - Comprehensive settings (14 fields across 4 sections)
  - Production-ready observability

---

## ğŸ—ï¸ Architecture

### Shared Core (`clockify_core/`)
Common functionality extracted for reuse:
- `ClockifyClient` - Async HTTP client with retry/backoff
- `OpenAPILoader` - Endpoint discovery from openapi.json
- `RateLimiter` - Token bucket rate limiting (50 RPS)
- `BaseClockifySettings` - Configuration base class

### Technology Stack
- **Python 3.11**
- **FastAPI** (async REST API)
- **httpx** (async HTTP client)
- **SQLAlchemy 2.x** + Alembic (async ORM + migrations)
- **SQLite** (dev) / **Postgres** (production)
- **Pydantic v2** (data validation)
- **jsonpath-ng** (flow condition evaluation)

---

## ğŸš€ Quick Start

### Prerequisites
- Python 3.11+
- pip and virtualenv

### Installation

```bash
# Clone repository
cd /path/to/clockify-api-studio-py-kit

# Create virtual environment
python3.11 -m venv venv
source venv/bin/activate

# Install dependencies
pip install -e .

# Run database migrations
alembic upgrade head
```

### Run API Studio

```bash
# Start server (port 8000)
uvicorn api_studio.main:app --reload

# Verify
curl http://localhost:8000/healthz
# {"status":"ok"}
```

### Run Universal Webhook

```bash
# Start server (port 8001)
uvicorn universal_webhook.main:app --reload --port 8001

# Verify
curl http://localhost:8001/healthz
# {"status":"ok","service":"universal-webhook"}
```

---

## ğŸ§ª Testing

```bash
# Run all tests (21 tests)
pytest tests/ -v

# Run api_studio tests only (9 tests)
pytest tests/test_integration.py tests/test_main.py -v

# Run universal_webhook tests only (12 tests)
pytest tests/test_universal_webhook.py -v

# Run with coverage
pytest tests/ --cov=api_studio --cov=universal_webhook --cov=clockify_core
```

**Current Status**: âœ… 21/21 tests passing (100%)

---

## ğŸ“š Documentation

### API Studio
- **Product Spec**: [`docs/clockify-api-studio-spec.md`](docs/clockify-api-studio-spec.md)
- **Architecture**: [`docs/ARCHITECTURE_API_STUDIO_PY.md`](docs/ARCHITECTURE_API_STUDIO_PY.md)
- **Implementation**: [`docs/IMPLEMENTATION_CHECKLIST_API_STUDIO_PY.md`](docs/IMPLEMENTATION_CHECKLIST_API_STUDIO_PY.md)
- **Security**: [`docs/SECURITY_AND_LIMITS_API_STUDIO_PY.md`](docs/SECURITY_AND_LIMITS_API_STUDIO_PY.md)
- **Status**: [`IMPLEMENTATION_STATUS.md`](IMPLEMENTATION_STATUS.md)

### Universal Webhook â­
- **Product Spec**: [`docs/clockify-universal-webhook-spec.md`](docs/clockify-universal-webhook-spec.md) ğŸ“–
- **Quickstart**: [`docs/QUICKSTART_UNIVERSAL_WEBHOOK.md`](docs/QUICKSTART_UNIVERSAL_WEBHOOK.md) ğŸš€
- **Progress**: [`UNIVERSAL_WEBHOOK_PROGRESS.md`](UNIVERSAL_WEBHOOK_PROGRESS.md)

### General
- **Clockify Add-on Guide**: [`docs/Clockify_Addon_Guide.md`](docs/Clockify_Addon_Guide.md)
- **Webhook Samples**: [`docs/Clockify_Webhook_JSON_Samples.md`](docs/Clockify_Webhook_JSON_Samples.md)
- **OpenAPI Spec**: [`docs/openapi.json`](docs/openapi.json)

---

## ğŸ“¦ Project Structure

```
clockify-api-studio-py-kit/
â”œâ”€â”€ clockify_core/          # Shared core modules
â”‚   â”œâ”€â”€ clockify_client.py  # HTTP client with retry/backoff
â”‚   â”œâ”€â”€ openapi_loader.py   # OpenAPI spec parsing
â”‚   â”œâ”€â”€ rate_limiter.py     # Rate limiting
â”‚   â””â”€â”€ config.py           # Base settings
â”œâ”€â”€ api_studio/             # API Studio add-on
â”‚   â”œâ”€â”€ lifecycle.py        # Lifecycle endpoints
â”‚   â”œâ”€â”€ webhooks.py         # Webhook receiver
â”‚   â”œâ”€â”€ bootstrap.py        # GET bootstrap
â”‚   â”œâ”€â”€ flows.py            # Flow engine
â”‚   â”œâ”€â”€ api_explorer.py     # API Explorer
â”‚   â”œâ”€â”€ ui.py               # UI endpoints
â”‚   â”œâ”€â”€ main.py             # FastAPI app
â”‚   â”œâ”€â”€ models.py           # Database models
â”‚   â””â”€â”€ ...
â”œâ”€â”€ universal_webhook/      # Universal Webhook add-on
â”‚   â”œâ”€â”€ lifecycle.py        # Enhanced lifecycle
â”‚   â”œâ”€â”€ webhooks.py         # Universal ingestion
â”‚   â”œâ”€â”€ bootstrap.py        # Enhanced bootstrap
â”‚   â”œâ”€â”€ flows.py            # Advanced flows
â”‚   â”œâ”€â”€ api_explorer.py     # Full API Explorer
â”‚   â”œâ”€â”€ ui.py               # Comprehensive UI
â”‚   â”œâ”€â”€ main.py             # FastAPI app
â”‚   â”œâ”€â”€ models.py           # Enhanced models
â”‚   â””â”€â”€ ...
â”œâ”€â”€ tests/                  # Test suite (21 tests)
â”‚   â”œâ”€â”€ test_integration.py # API Studio tests
â”‚   â”œâ”€â”€ test_main.py        # API Studio tests
â”‚   â””â”€â”€ test_universal_webhook.py  # Universal Webhook tests
â”œâ”€â”€ docs/                   # Documentation
â”œâ”€â”€ alembic/                # Database migrations
â”œâ”€â”€ manifest.api-studio.json
â”œâ”€â”€ manifest.universal-webhook.json
â””â”€â”€ pyproject.toml
```

---

## ğŸ”§ Configuration

### Environment Variables

#### API Studio
```bash
API_STUDIO_DB_URL=sqlite+aiosqlite:///./api_studio.db
API_STUDIO_BOOTSTRAP_MAX_RPS=25
API_STUDIO_BOOTSTRAP_INCLUDE_HEAVY_ENDPOINTS=false
LOG_LEVEL=INFO
CLOCKIFY_API_BASE_URL=https://api.clockify.me
```

#### Universal Webhook
```bash
UNIVERSAL_WEBHOOK_DB_URL=sqlite+aiosqlite:///./universal_webhook.db
UW_BOOTSTRAP_MAX_RPS=25
UW_BOOTSTRAP_INCLUDE_HEAVY=false
UW_BOOTSTRAP_INCLUDE_TIME_ENTRIES=false
UW_ENABLE_CUSTOM_WEBHOOKS=true
UW_ENABLE_FLOWS=true
UW_ENABLE_GENERIC_HTTP_ACTIONS=false
UW_WEBHOOK_LOG_RETENTION_DAYS=90
LOG_LEVEL=INFO
```

### Manifest Settings

Both add-ons support structured settings via Clockify UI that override environment variables.

---

## ğŸš¢ Deployment

### Local Development
```bash
# API Studio
uvicorn api_studio.main:app --reload --port 8000

# Universal Webhook
uvicorn universal_webhook.main:app --reload --port 8001
```

### Production
```bash
# Use Gunicorn + Uvicorn workers
gunicorn api_studio.main:app \
  --workers 4 \
  --worker-class uvicorn.workers.UvicornWorker \
  --bind 0.0.0.0:8000

gunicorn universal_webhook.main:app \
  --workers 4 \
  --worker-class uvicorn.workers.UvicornWorker \
  --bind 0.0.0.0:8001
```

### Production Checklist
- [ ] Switch to Postgres (`DATABASE_URL`)
- [ ] Configure public URL for webhooks
- [ ] Update `baseUrl` in manifests
- [ ] Set up SSL/TLS
- [ ] Enable log aggregation
- [ ] Configure monitoring/alerting
- [ ] Set up database backups
- [ ] Review security settings

---

## ğŸ†š Comparison: API Studio vs Universal Webhook

| Feature | API Studio | Universal Webhook |
|---------|-----------|------------------|
| **Plan Requirement** | STANDARD | ENTERPRISE |
| **Webhook Events** | 12 common | ALL 50+ |
| **Custom Webhooks** | âŒ | âœ… |
| **Scopes** | 7 resources | 15+ resources (ALL) |
| **API Explorer** | Safe GET only | ALL operations |
| **Bootstrap** | Basic | Enhanced (configurable) |
| **Flows** | Basic Clockify API | Advanced (+ generic HTTP) |
| **Settings** | 3 fields | 14 fields |
| **Use Case** | Prototyping | Production automation |
| **Tests** | 9 tests | 12 tests |
| **Port** | 8000 | 8001 |

---

## ğŸ‰ Status

âœ… **Both add-ons are fully implemented and production-ready**

- âœ… **API Studio**: Complete with 9 passing tests
- âœ… **Universal Webhook**: Complete with 12 passing tests
- âœ… **Shared Core**: Working correctly across both add-ons
- âœ… **Documentation**: Comprehensive specs and quickstart guides
- âœ… **Database**: Migrations applied, schemas validated
- âœ… **Tests**: 21/21 passing (100%)

---

## ğŸ“ License

Internal use / proprietary
